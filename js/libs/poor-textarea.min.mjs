function S(n,a,c){return n>=a&&n<=c}function V(n){let{key:a}=n,c=n.ctrlKey||n.metaKey;return a.toLowerCase()==="z"&&c}function j(n){let{key:a,shiftKey:c}=n,K=n.ctrlKey||n.metaKey;return a.toLowerCase()==="z"&&K&&c}function z(n){let{key:a}=n,c=n.ctrlKey||n.metaKey;return a.toLowerCase()==="tab"&&!c}function A(n){let{key:a}=n,c=n.ctrlKey||n.metaKey;return a==="/"&&c}var _=function(n,a){let c=a?.maxHistoryCount||500,K=a?.pairs||{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"},p={onUndo:null,onRedo:null,onKeydown:null,onKeyup:null,onMouseup:null,onBeforeinput:null,onInput:null},r=[],i=1,C=function(t){let{key:e}=t;return Object.keys(K).includes(e)},w=function(){let t=Math.min(n.selectionStart,n.selectionEnd),e=Math.max(n.selectionStart,n.selectionEnd),o=n.selectionStart>n.selectionEnd;return{cursorStart:t,cursorEnd:e,isReversed:o}},E=function(t,e,o=!1){o?n.setSelectionRange(e,t):n.setSelectionRange(t,e),n.focus()},M=function(){if(i<r.length)return i+=1,r[r.length-i]},m=function(){if(i>1)return i-=1,r[r.length-i]},L=function(){i>1&&(r=r.slice(0,r.length-(i-1)),i=1)},g=function(t=!0){t&&L(),r.push({value:n.value,start:n.selectionStart,end:n.selectionEnd}),r.length>c&&r.shift()},I=function(t){n.value=t.value,E(t.start,t.end)},H=function(){let{cursorStart:t,cursorEnd:e}=w(),o=n.value.split(/\n/),s=[],y=0;for(let d=0;d<o.length;d++){let u=o[d],v=y,l=y+u.length,h=!(v>e||l<t);s.push({isSelected:h,rowIndex:d,startIndex:v,endIndex:l,value:u}),y=l+1}return s},k=function(t,e){let{cursorStart:o,cursorEnd:s,isReversed:y}=w(),d=o,u=s,v=[];for(let l of t){let{isSelected:h,startIndex:b,endIndex:x}=l;if(!h){v.push(l.value);continue}let P=l.value,R=e(l),f=R.length-P.length;S(o,b,x)?(f>=0?o!==b&&(d+=f):d+=Math.max(f,b-o),f>=0?u+=f:u+=Math.max(f,b-s)):S(s,b,x)?f>=0?u+=f:u+=Math.max(f,b-s):u+=f,v.push(R)}n.value=v.join(`
`),E(d,u,y)},B=function(t){let e=t.key,o=K[e],{cursorStart:s,cursorEnd:y,isReversed:d}=w(),u=n.value.substring(0,s),v=n.value.substring(s,y),l=n.value.substring(y);if(s===y){n.value=u+e+o+l;let h=(u+e).length;E(h,h)}else{n.value=u+e+v+o+l;let h=(u+e).length,b=(u+e+v).length;E(h,b,d)}},D=t=>{if(j(t)){t.preventDefault();let e=m();e&&I(e),p.onRedo?.(t,r)}else if(V(t)){t.preventDefault();let e=M();e&&I(e),p.onUndo?.(t,r)}else if(A(t)){t.preventDefault();let e=H(),o=!1;for(let s of e)if(s.isSelected&&s.value.startsWith("//")){o=!0;break}k(e,s=>o?s.value.replace(/^\/\/\s?/,""):s.value.trim()?"// "+s.value:s.value),g()}else if(z(t)){t.preventDefault();let e=H();k(e,o=>t.shiftKey?o.value.replace(/^\s{1,2}/,""):o.value.trim()?"  "+o.value:o.value),g()}else C(t)&&(t.preventDefault(),i!==1&&g(),B(t),g());p.onKeydown?.(t,r)},U=t=>{["arrowleft","arrowright","arrowup","arrowdown","home","end","pageup","pagedown","escape"].includes(t.key.toLowerCase())&&(i===1&&g(),p.onKeyup?.(t,r))},N=t=>{i===1&&g(),p.onMouseup?.(t,r)},T=t=>{i!==1&&g(),p.onBeforeinput?.(t,r)},O=t=>{g(),p.onInput?.(t,r)};return n.addEventListener("keydown",D),n.addEventListener("keyup",U),n.addEventListener("mouseup",N),n.addEventListener("beforeinput",T),n.addEventListener("input",O),p};export{_ as init};
