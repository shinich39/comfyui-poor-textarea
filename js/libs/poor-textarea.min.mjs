function M(n,u,l){return n>=u&&n<=l}function z(n){let{key:u}=n,l=n.ctrlKey||n.metaKey;return u.toLowerCase()==="z"&&l}function A(n){let{key:u,shiftKey:l}=n,K=n.ctrlKey||n.metaKey;return u.toLowerCase()==="z"&&K&&l}function _(n){let{key:u}=n,l=n.ctrlKey||n.metaKey;return u.toLowerCase()==="tab"&&!l}function W(n){let{key:u}=n,l=n.ctrlKey||n.metaKey;return u==="/"&&l}var X=function(n,u){let l=u?.maxHistoryCount||500,K=u?.pairs||{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"},p={onUndo:null,onRedo:null,onKeydown:null,onKeyup:null,onMouseup:null,onBeforeinput:null,onInput:null},r=[],i=1,L=function(t){let{key:e}=t;return Object.keys(K).includes(e)},k=function(){return n.selectionStart!==n.selectionEnd},w=function(){let t=Math.min(n.selectionStart,n.selectionEnd),e=Math.max(n.selectionStart,n.selectionEnd),o=n.selectionStart>n.selectionEnd;return{cursorStart:t,cursorEnd:e,isReversed:o}},E=function(t,e,o=!1){o?n.setSelectionRange(e,t):n.setSelectionRange(t,e),n.focus()},m=function(){if(i<r.length)return i+=1,r[r.length-i]},B=function(){if(i>1)return i-=1,r[r.length-i]},D=function(){i>1&&(r=r.slice(0,r.length-(i-1)),i=1)},g=function(t=!0){t&&D(),r.push({value:n.value,start:n.selectionStart,end:n.selectionEnd}),r.length>l&&r.shift()},R=function(t){n.value=t.value,E(t.start,t.end)},S=function(){let{cursorStart:t,cursorEnd:e}=w(),o=n.value.split(/\n/),s=[],v=0;for(let b=0;b<o.length;b++){let c=o[b],a=v,f=v+c.length,d=!(a>e||f<t);s.push({isSelected:d,rowIndex:b,startIndex:a,endIndex:f,value:c}),v=f+1}return s},x=function(t,e){let{cursorStart:o,cursorEnd:s,isReversed:v}=w(),b=o!==s,c=o,a=s,f=[];for(let d of t){let{isSelected:I,startIndex:h,endIndex:H}=d;if(!I){f.push(d.value);continue}let j=d.value,C=e(d),y=C.length-j.length;M(o,h,H)?(y>=0?c+=y:c+=Math.max(y,h-o),y>=0?a+=y:a+=Math.max(y,h-s)):M(s,h,H)?y>=0?a+=y:a+=Math.max(y,h-s):a+=y,f.push(C)}n.value=f.join(`
`),E(c,a,v)},U=function(t){let e=t.key,o=K[e],{cursorStart:s,cursorEnd:v,isReversed:b}=w(),c=n.value.substring(0,s),a=n.value.substring(s,v),f=n.value.substring(v);if(s===v){n.value=c+e+o+f;let d=(c+e).length;E(d,d)}else{n.value=c+e+a+o+f;let d=(c+e).length,I=(c+e+a).length;E(d,I,b)}},N=t=>{if(A(t)){t.preventDefault();let e=B();e&&R(e),p.onRedo?.(t,r)}else if(z(t)){t.preventDefault();let e=m();e&&R(e),p.onUndo?.(t,r)}else if(W(t)){t.preventDefault();let e=S(),o=!1;for(let s of e)if(s.isSelected&&s.value.startsWith("//")){o=!0;break}x(e,s=>o?s.value.replace(/^\/\/\s?/,""):s.value.trim()||!k()?"// "+s.value:s.value),g()}else if(_(t)){t.preventDefault();let e=S();x(e,o=>t.shiftKey?o.value.replace(/^\s{1,2}/,""):o.value.trim()||!k()?"  "+o.value:o.value),g()}else L(t)&&(t.preventDefault(),i!==1&&g(),U(t),g());p.onKeydown?.(t,r)},T=t=>{["arrowleft","arrowright","arrowup","arrowdown","home","end","pageup","pagedown","escape"].includes(t.key.toLowerCase())&&(i===1&&g(),p.onKeyup?.(t,r))},O=t=>{i===1&&g(),p.onMouseup?.(t,r)},P=t=>{i!==1&&g(),p.onBeforeinput?.(t,r)},V=t=>{g(),p.onInput?.(t,r)};return n.addEventListener("keydown",N),n.addEventListener("keyup",T),n.addEventListener("mouseup",O),n.addEventListener("beforeinput",P),n.addEventListener("input",V),p};export{X as init};
