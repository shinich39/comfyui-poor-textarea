function R(t,c,a){return t>=c&&t<=a}function A(t){let{key:c}=t,a=t.ctrlKey||t.metaKey;return c==="z"&&a}function P(t){let{key:c,shiftKey:a}=t,b=t.ctrlKey||t.metaKey;return c==="z"&&b&&a}function T(t){let{key:c}=t,a=t.ctrlKey||t.metaKey;return c==="Tab"&&!a}function U(t){let{key:c}=t,a=t.ctrlKey||t.metaKey;return c==="/"&&a}var O=function(t,c){let a=c?.maxHistoryCount||500,b=c?.pairs||{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"},u=[],i=1,H=function(n){let{key:e}=n;return Object.keys(b).includes(e)},I=function(){let n=Math.min(t.selectionStart,t.selectionEnd),e=Math.max(t.selectionStart,t.selectionEnd),s=t.selectionStart>t.selectionEnd;return{cursorStart:n,cursorEnd:e,isReversed:s}},E=function(n,e,s=!1){s?t.setSelectionRange(e,n):t.setSelectionRange(n,e),t.focus()},C=function(){if(i<u.length)return i+=1,u[u.length-i]},m=function(){if(i>1)return i-=1,u[u.length-i]},D=function(){i>1&&(u=u.slice(0,u.length-(i-1)),i=1)},g=function(n=!0){n&&D(),u.push({value:t.value,start:t.selectionStart,end:t.selectionEnd}),u.length>a&&u.shift()},K=function(n){t.value=n.value,E(n.start,n.end)},x=function(){let{cursorStart:n,cursorEnd:e}=I(),s=t.value.split(/\n/),r=[],v=0;for(let f=0;f<s.length;f++){let o=s[f],y=v,l=v+o.length,h=!(y>e||l<n);r.push({isSelected:h,rowIndex:f,startIndex:y,endIndex:l,value:o}),v=l+1}return r},w=function(n,e){let{cursorStart:s,cursorEnd:r,isReversed:v}=I(),f=s,o=r,y=[];for(let l of n){let{isSelected:h,startIndex:p,endIndex:S}=l;if(!h){y.push(l.value);continue}let M=l.value,k=e(l),d=k.length-M.length;R(s,p,S)?(d>=0?s!==p&&(f+=d):f+=Math.max(d,p-s),d>=0?o+=d:o+=Math.max(d,p-r)):R(r,p,S)?d>=0?o+=d:o+=Math.max(d,p-r):o+=d,y.push(k)}t.value=y.join(`
`),E(f,o,v)},L=function(n){let e=n.key,s=b[e],{cursorStart:r,cursorEnd:v,isReversed:f}=I(),o=t.value.substring(0,r),y=t.value.substring(r,v),l=t.value.substring(v);if(r===v){t.value=o+e+s+l;let h=(o+e).length;E(h,h)}else{t.value=o+e+y+s+l;let h=(o+e).length,p=(o+e+y).length;E(h,p,f)}};t.addEventListener("keydown",n=>{if(P(n)){n.preventDefault();let e=m();e&&K(e)}else if(A(n)){n.preventDefault();let e=C();e&&K(e)}else if(U(n)){n.preventDefault();let e=x(),s=!1;for(let r of e)if(r.isSelected&&r.value.startsWith("//")){s=!0;break}w(e,r=>s?r.value.replace(/^\/\/\s?/,""):r.value.trim()?"// "+r.value:r.value),g()}else if(T(n)){n.preventDefault();let e=x();w(e,s=>n.shiftKey?s.value.replace(/^\s{1,2}/,""):s.value.trim()?"  "+s.value:s.value),g()}else H(n)&&(n.preventDefault(),i!==1&&g(),L(n),g())}),t.addEventListener("keyup",n=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown","Escape"].includes(n.key)&&i===1&&g()}),t.addEventListener("mouseup",n=>{i===1&&g()}),t.addEventListener("beforeinput",n=>{i!==1&&g()}),t.addEventListener("input",n=>{g()})};export{O as init};
