function R(t,c,u){return t>=c&&t<=u}function m(t){let{key:c}=t,u=t.ctrlKey||t.metaKey;return c==="z"&&u}function P(t){let{key:c,shiftKey:u}=t,b=t.ctrlKey||t.metaKey;return c==="z"&&b&&u}function T(t){let{key:c}=t,u=t.ctrlKey||t.metaKey;return c==="Tab"&&!u}function U(t){let{key:c}=t,u=t.ctrlKey||t.metaKey;return c==="/"&&u}var O=function(t,c){let u=c?.maxHistoryCount||500,b=c?.pairs||{"(":")","[":"]","{":"}","<":">","'":"'",'"':'"',"`":"`"},a=[],i=1,H=function(n){let{key:e}=n;return Object.keys(b).includes(e)},w=function(){let n=Math.min(t.selectionStart,t.selectionEnd),e=Math.max(t.selectionStart,t.selectionEnd),s=t.selectionStart>t.selectionEnd;return{cursorStart:n,cursorEnd:e,isReversed:s}},E=function(n,e,s=!1){s?t.setSelectionRange(e,n):t.setSelectionRange(n,e),t.focus()},C=function(){if(i<a.length)return i+=1,a[a.length-i]},D=function(){if(i>1)return i-=1,a[a.length-i]},L=function(){i>1&&(a=a.slice(0,a.length-(i-1)),i=1)},v=function(n=!0){n&&L(),a.push({value:t.value,start:t.selectionStart,end:t.selectionEnd}),a.length>u&&a.shift()},I=function(n){t.value=n.value,E(n.start,n.end)},K=function(){let{cursorStart:n,cursorEnd:e}=w(),s=t.value.split(/\n/),r=[],d=0;for(let l=0;l<s.length;l++){let o=s[l],y=d,f=d+o.length,g=!(y>e||f<n);r.push({isSelected:g,rowIndex:l,startIndex:y,endIndex:f,value:o}),d=f+1}return r},x=function(n,e){let{cursorStart:s,cursorEnd:r,isReversed:d}=w(),l=s,o=r,y=[];for(let f of n){let{isSelected:g,startIndex:p,endIndex:S}=f;if(!g){y.push(f.value);continue}let M=f.value,k=e(f),h=k.length-M.length;R(s,p,S)?(h>=0?s!==p&&(l+=h):l+=Math.max(h,p-s),o+=h):R(r,p,S)?h>=0?o+=h:o+=Math.max(h,p-r):o+=h,y.push(k)}t.value=y.join(`
`),E(l,o,d)},A=function(n){let e=n.key,s=b[e],{cursorStart:r,cursorEnd:d,isReversed:l}=w(),o=t.value.substring(0,r),y=t.value.substring(r,d),f=t.value.substring(d);if(r===d){t.value=o+e+s+f;let g=(o+e).length;E(g,g)}else{t.value=o+e+y+s+f;let g=(o+e).length,p=(o+e+y).length;E(g,p,l)}};t.addEventListener("keydown",n=>{if(P(n)){n.preventDefault();let e=D();e&&I(e)}else if(m(n)){n.preventDefault();let e=C();e&&I(e)}else if(U(n)){n.preventDefault();let e=K(),s=!1;for(let r of e)if(r.isSelected&&r.value.trim()&&r.value.startsWith("//")){s=!0;break}x(e,r=>s?r.value.replace(/^\/\/\s?/,""):"// "+r.value),v()}else if(T(n)){n.preventDefault();let e=K();x(e,s=>n.shiftKey?s.value.replace(/^\s{1,2}/,""):"  "+s.value),v()}else H(n)&&(n.preventDefault(),i!==1&&v(),A(n),v())}),t.addEventListener("keyup",n=>{["ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Home","End","PageUp","PageDown","Escape"].includes(n.key)&&i===1&&v()}),t.addEventListener("mouseup",n=>{i===1&&v()}),t.addEventListener("beforeinput",n=>{i!==1&&v()}),t.addEventListener("input",n=>{v()})};export{O as init};
